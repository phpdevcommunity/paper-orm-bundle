services:
  _defaults:
    autowire: true
    autoconfigure: true
  paper.stream_handler:
    class: Monolog\Handler\StreamHandler
    arguments:
      - '%kernel.logs_dir%/paper.log'
      - 'debug'

  paper.logger:
    class: Monolog\Logger
    arguments:
      - 'paper'                 # nom du channel
      - [ '@paper.stream_handler' ]

  PhpDevCommunity\PaperORM\Collector\EntityDirCollector:
    factory: ['PhpDevCommunity\PaperORM\Collector\EntityDirCollector', 'bootstrap']
    arguments:
      - ['%paper_orm.entity_dir%']
  PhpDevCommunity\PaperORM\PaperConfiguration:
    factory: ['PhpDevCommunity\PaperORM\PaperConfiguration', 'fromDsn']
    arguments:
      - '%paper_orm.dsn%'
      - '%paper_orm.debug%'
    calls:
          - [ withLogger, [ '@paper.logger' ] ]

  PhpDevCommunity\PaperORM\Migration\PaperMigration:
    factory: ['PhpDevCommunity\PaperORM\Migration\PaperMigration', 'create']
    arguments:
      - '@PhpDevCommunity\PaperORM\EntityManager'
      - '%paper_orm.migrations_table%'
      - '%paper_orm.migrations_dir%'

  PhpDevCommunity\PaperORM\EntityManager:
    factory: ['PhpDevCommunity\PaperORM\EntityManager', 'createFromConfig']
    arguments:
      - '@PhpDevCommunity\PaperORM\PaperConfiguration'

  PhpDevCommunity\PaperORM\EntityManagerInterface:
    alias: PhpDevCommunity\PaperORM\EntityManager
    public: false

  PhpDevCommunity\PaperORMBundle\Command\:
    resource: '../src/Command'
    tags: ['console.command']

  PhpDevCommunity\PaperORMBundle\DataCollector\PaperORMCollector:
    tags:
      - { name: data_collector, template: '@PaperORMBundle/data_collector/template.html.twig', id: 'paper_orm' }
